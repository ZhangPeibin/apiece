{"ast":null,"code":"import * as bip39 from \"bip39\";\nimport { pbkdf2Sync } from \"crypto\";\nimport { Buckets, PushPathResult, KeyInfo, PrivateKey, WithKeyInfoOptions } from '@textile/hub';\n/**\n * 创建助词器\n */\n\nexport function createMnemonic() {\n  var bip39Mnemonic = bip39.generateMnemonic();\n  console.log(\"mnemonic:\" + bip39Mnemonic);\n  return bip39Mnemonic;\n}\nexport function createSeedByMnemonic(mnemonic) {\n  const seed = pbkdf2Sync(mnemonic, 'salt', 1024, 32, 'sha512');\n  return seed;\n}\nexport async function getLocalUserIdentity() {\n  var localUserIdentity = localStorage.getItem(\"private.user.identity\");\n\n  if (localUserIdentity == null) {\n    return null;\n  }\n\n  return localUserIdentity;\n}\n\nasync function getIdentity() {\n  try {\n    var storedIdent = localStorage.getItem(\"pirvate.identity\");\n\n    if (storedIdent === null) {\n      throw new Error('No identity');\n    }\n\n    const restored = PrivateKey.fromString(storedIdent);\n    return restored;\n  } catch (e) {\n    /**\n     * If any error, create a new identity.\n     */\n    try {\n      // const identity = PrivateKey.fromRandom()\n      const identity = new PrivateKey(createSeedByMnemonic(createMnemonic()), 'ed25519');\n      const identityString = identity.toString();\n      console.log(identityString);\n      localStorage.setItem(\"identity\", identityString);\n      return identity;\n    } catch (err) {\n      return err.message;\n    }\n  }\n}","map":{"version":3,"sources":["/Users/wiki/code/filecoin/private.storage/src/functions/user/user.js"],"names":["bip39","pbkdf2Sync","Buckets","PushPathResult","KeyInfo","PrivateKey","WithKeyInfoOptions","createMnemonic","bip39Mnemonic","generateMnemonic","console","log","createSeedByMnemonic","mnemonic","seed","getLocalUserIdentity","localUserIdentity","localStorage","getItem","getIdentity","storedIdent","Error","restored","fromString","e","identity","identityString","toString","setItem","err","message"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAAQC,UAAR,QAAyB,QAAzB;AACA,SAASC,OAAT,EAAkBC,cAAlB,EAAkCC,OAAlC,EAA2CC,UAA3C,EAAuDC,kBAAvD,QAAiF,cAAjF;AACA;AACA;AACA;;AACA,OAAU,SAASC,cAAT,GAA0B;AAChC,MAAIC,aAAa,GAAGR,KAAK,CAACS,gBAAN,EAApB;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAY,cAAYH,aAAxB;AACA,SAAOA,aAAP;AACH;AAED,OAAO,SAASI,oBAAT,CAA8BC,QAA9B,EAAwC;AAC3C,QAAMC,IAAI,GAAEb,UAAU,CAACY,QAAD,EAAW,MAAX,EAAmB,IAAnB,EAAyB,EAAzB,EAA6B,QAA7B,CAAtB;AACA,SAAOC,IAAP;AACH;AACD,OAAO,eAAgBC,oBAAhB,GAAsC;AACzC,MAAIC,iBAAiB,GAAGC,YAAY,CAACC,OAAb,CAAqB,uBAArB,CAAxB;;AACA,MAAIF,iBAAiB,IAAE,IAAvB,EAA4B;AACxB,WAAO,IAAP;AACH;;AACD,SAAOA,iBAAP;AACH;;AAED,eAAeG,WAAf,GAA8B;AAC1B,MAAI;AACA,QAAIC,WAAW,GAAGH,YAAY,CAACC,OAAb,CAAqB,kBAArB,CAAlB;;AACA,QAAIE,WAAW,KAAK,IAApB,EAA0B;AACtB,YAAM,IAAIC,KAAJ,CAAU,aAAV,CAAN;AACH;;AACD,UAAMC,QAAQ,GAAGjB,UAAU,CAACkB,UAAX,CAAsBH,WAAtB,CAAjB;AACA,WAAOE,QAAP;AACH,GAPD,CAQA,OAAOE,CAAP,EAAU;AACN;AACR;AACA;AACQ,QAAI;AACA;AACA,YAAMC,QAAQ,GAAG,IAAIpB,UAAJ,CAAeO,oBAAoB,CAACL,cAAc,EAAf,CAAnC,EAAsD,SAAtD,CAAjB;AACA,YAAMmB,cAAc,GAAGD,QAAQ,CAACE,QAAT,EAAvB;AACAjB,MAAAA,OAAO,CAACC,GAAR,CAAYe,cAAZ;AACAT,MAAAA,YAAY,CAACW,OAAb,CAAqB,UAArB,EAAgCF,cAAhC;AACA,aAAOD,QAAP;AACH,KAPD,CAOE,OAAOI,GAAP,EAAY;AACV,aAAOA,GAAG,CAACC,OAAX;AACH;AACJ;AACJ","sourcesContent":["import * as bip39 from \"bip39\";\nimport {pbkdf2Sync} from \"crypto\";\nimport { Buckets, PushPathResult, KeyInfo, PrivateKey, WithKeyInfoOptions } from '@textile/hub'\n/**\n * 创建助词器\n */\nexport    function createMnemonic() {\n    var bip39Mnemonic = bip39.generateMnemonic();\n    console.log(\"mnemonic:\"+bip39Mnemonic)\n    return bip39Mnemonic\n}\n\nexport function createSeedByMnemonic(mnemonic) {\n    const seed= pbkdf2Sync(mnemonic, 'salt', 1024, 32, 'sha512');\n    return seed\n}\nexport async  function getLocalUserIdentity(){\n    var localUserIdentity = localStorage.getItem(\"private.user.identity\");\n    if( localUserIdentity==null){\n        return null;\n    }\n    return localUserIdentity\n}\n\nasync function getIdentity()  {\n    try {\n        var storedIdent = localStorage.getItem(\"pirvate.identity\");\n        if (storedIdent === null) {\n            throw new Error('No identity')\n        }\n        const restored = PrivateKey.fromString(storedIdent);\n        return restored\n    }\n    catch (e) {\n        /**\n         * If any error, create a new identity.\n         */\n        try {\n            // const identity = PrivateKey.fromRandom()\n            const identity = new PrivateKey(createSeedByMnemonic(createMnemonic()),'ed25519')\n            const identityString = identity.toString();\n            console.log(identityString);\n            localStorage.setItem(\"identity\",identityString);\n            return identity\n        } catch (err) {\n            return err.message\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}