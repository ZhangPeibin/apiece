{"ast":null,"code":"import * as bip39 from \"bip39\";\nimport { pbkdf2Sync } from \"crypto\";\nimport { PrivateKey } from '@textile/hub';\n/**\n * 创建助词器\n */\n\nexport function createMnemonic() {\n  var bip39Mnemonic = bip39.generateMnemonic();\n  console.log(\"mnemonic:\" + bip39Mnemonic);\n  return bip39Mnemonic;\n}\nexport function createSeedByMnemonic(mnemonic) {\n  const seed = pbkdf2Sync(mnemonic, 'salt', 1024, 32, 'sha512');\n  return seed;\n}\nexport function userIdentityFromSeed(seed) {\n  const identity = new PrivateKey(seed, 'ed25519');\n  return identity;\n}\nexport async function getLocalUserIdentity() {\n  const localUserIdentity = localStorage.getItem(\"private.user.identity\");\n\n  if (localUserIdentity == null) {\n    return null;\n  }\n\n  const restored = PrivateKey.fromString(localUserIdentity);\n  return restored;\n}\nexport function saveLocalUserIdentity(userIdentity) {\n  localStorage.setItem(\"private.user.identity\", userIdentity);\n}\n\nasync function getIdentity() {\n  try {\n    var storedIdent = localStorage.getItem(\"pirvate.identity\");\n\n    if (storedIdent === null) {\n      throw new Error('No identity');\n    }\n\n    const restored = PrivateKey.fromString(storedIdent);\n    return restored;\n  } catch (e) {\n    /**\n     * If any error, create a new identity.\n     */\n    try {\n      // const identity = PrivateKey.fromRandom()\n      const identity = new PrivateKey(createSeedByMnemonic(createMnemonic()), 'ed25519');\n      const identityString = identity.toString();\n      console.log(identityString);\n      localStorage.setItem(\"identity\", identityString);\n      return identity;\n    } catch (err) {\n      return err.message;\n    }\n  }\n}","map":{"version":3,"sources":["/Users/wiki/code/filecoin/private.storage/src/common/user.js"],"names":["bip39","pbkdf2Sync","PrivateKey","createMnemonic","bip39Mnemonic","generateMnemonic","console","log","createSeedByMnemonic","mnemonic","seed","userIdentityFromSeed","identity","getLocalUserIdentity","localUserIdentity","localStorage","getItem","restored","fromString","saveLocalUserIdentity","userIdentity","setItem","getIdentity","storedIdent","Error","e","identityString","toString","err","message"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAAQC,UAAR,QAAyB,QAAzB;AACA,SAAQC,UAAR,QAAyB,cAAzB;AAEA;AACA;AACA;;AACA,OAAO,SAASC,cAAT,GAA0B;AAC7B,MAAIC,aAAa,GAAGJ,KAAK,CAACK,gBAAN,EAApB;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAY,cAAcH,aAA1B;AACA,SAAOA,aAAP;AACH;AAED,OAAO,SAASI,oBAAT,CAA8BC,QAA9B,EAAwC;AAC3C,QAAMC,IAAI,GAAGT,UAAU,CAACQ,QAAD,EAAW,MAAX,EAAmB,IAAnB,EAAyB,EAAzB,EAA6B,QAA7B,CAAvB;AACA,SAAOC,IAAP;AACH;AAED,OAAO,SAASC,oBAAT,CAA8BD,IAA9B,EAAoC;AACvC,QAAME,QAAQ,GAAG,IAAIV,UAAJ,CAAeQ,IAAf,EAAqB,SAArB,CAAjB;AACA,SAAOE,QAAP;AACH;AAED,OAAO,eAAeC,oBAAf,GAAsC;AACzC,QAAMC,iBAAiB,GAAGC,YAAY,CAACC,OAAb,CAAqB,uBAArB,CAA1B;;AACA,MAAIF,iBAAiB,IAAI,IAAzB,EAA+B;AAC3B,WAAO,IAAP;AACH;;AACD,QAAMG,QAAQ,GAAGf,UAAU,CAACgB,UAAX,CAAsBJ,iBAAtB,CAAjB;AACA,SAAOG,QAAP;AACH;AAED,OAAO,SAASE,qBAAT,CAA+BC,YAA/B,EAA6C;AAChDL,EAAAA,YAAY,CAACM,OAAb,CAAqB,uBAArB,EAA8CD,YAA9C;AACH;;AAED,eAAeE,WAAf,GAA6B;AACzB,MAAI;AACA,QAAIC,WAAW,GAAGR,YAAY,CAACC,OAAb,CAAqB,kBAArB,CAAlB;;AACA,QAAIO,WAAW,KAAK,IAApB,EAA0B;AACtB,YAAM,IAAIC,KAAJ,CAAU,aAAV,CAAN;AACH;;AACD,UAAMP,QAAQ,GAAGf,UAAU,CAACgB,UAAX,CAAsBK,WAAtB,CAAjB;AACA,WAAON,QAAP;AACH,GAPD,CAOE,OAAOQ,CAAP,EAAU;AACR;AACR;AACA;AACQ,QAAI;AACA;AACA,YAAMb,QAAQ,GAAG,IAAIV,UAAJ,CAAeM,oBAAoB,CAACL,cAAc,EAAf,CAAnC,EAAuD,SAAvD,CAAjB;AACA,YAAMuB,cAAc,GAAGd,QAAQ,CAACe,QAAT,EAAvB;AACArB,MAAAA,OAAO,CAACC,GAAR,CAAYmB,cAAZ;AACAX,MAAAA,YAAY,CAACM,OAAb,CAAqB,UAArB,EAAiCK,cAAjC;AACA,aAAOd,QAAP;AACH,KAPD,CAOE,OAAOgB,GAAP,EAAY;AACV,aAAOA,GAAG,CAACC,OAAX;AACH;AACJ;AACJ","sourcesContent":["import * as bip39 from \"bip39\";\nimport {pbkdf2Sync} from \"crypto\";\nimport {PrivateKey} from '@textile/hub'\n\n/**\n * 创建助词器\n */\nexport function createMnemonic() {\n    var bip39Mnemonic = bip39.generateMnemonic();\n    console.log(\"mnemonic:\" + bip39Mnemonic)\n    return bip39Mnemonic\n}\n\nexport function createSeedByMnemonic(mnemonic) {\n    const seed = pbkdf2Sync(mnemonic, 'salt', 1024, 32, 'sha512');\n    return seed\n}\n\nexport function userIdentityFromSeed(seed) {\n    const identity = new PrivateKey(seed, 'ed25519');\n    return identity;\n}\n\nexport async function getLocalUserIdentity() {\n    const localUserIdentity = localStorage.getItem(\"private.user.identity\");\n    if (localUserIdentity == null) {\n        return null;\n    }\n    const restored = PrivateKey.fromString(localUserIdentity);\n    return restored\n}\n\nexport function saveLocalUserIdentity(userIdentity) {\n    localStorage.setItem(\"private.user.identity\", userIdentity);\n}\n\nasync function getIdentity() {\n    try {\n        var storedIdent = localStorage.getItem(\"pirvate.identity\");\n        if (storedIdent === null) {\n            throw new Error('No identity')\n        }\n        const restored = PrivateKey.fromString(storedIdent);\n        return restored\n    } catch (e) {\n        /**\n         * If any error, create a new identity.\n         */\n        try {\n            // const identity = PrivateKey.fromRandom()\n            const identity = new PrivateKey(createSeedByMnemonic(createMnemonic()), 'ed25519')\n            const identityString = identity.toString();\n            console.log(identityString);\n            localStorage.setItem(\"identity\", identityString);\n            return identity\n        } catch (err) {\n            return err.message\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}